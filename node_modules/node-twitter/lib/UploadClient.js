var t=require("crypto"),e=require("fs"),a=require("path"),i=require("util"),r=require("./Client"),s=require("./Constants"),o=require("./RestParameterValidator"),n=require("request"),d=function(t,e,a,i){r.call(this,t,e,a,i),this._apiBaseUrlString=s.UploadApiBaseURLString,this._apiVersion=s.UploadApiVersion,this._validator=new o};i.inherits(d,r),d.prototype.statusesUpdateWithMedia=function(t,e){var a;if(void 0===t.status)throw Error("Missing required parameter: status.");if(void 0===t["media[]"])throw Error("Missing required parameter: media[].");this._validator.validateDisplayCoordinates(t),this._validator.validateInReplyToStatusId(t),this._validator.validatePlaceId(t),this._validator.validatePossiblySensitive(t),this._validator.validateLatitude(t),this._validator.validateLongitude(t),this._validator.validateMedia(t),this._validator.validateStatus(t),a="statuses/update_with_media",this._createPostRequest(a,"json",t,e)},d.prototype._createPostRequest=function(i,r,s,o){var d,u,l,p,h=Object.keys(s).filter(function(t){return"media[]"!=t}).map(function(t){return{"content-disposition":'form-data; name="'+t+'"',"content-type":"text/plain",body:s[t]}}),c=a.normalize(s["media[]"]),m=a.extname(c),v=this._mimeTypeForPathExtension(m);if(null===v)throw Error("Unsupported media type.");d={"content-disposition":'form-data; name="media[]"',"content-type":v,"content-transfer-encoding":"utf8",body:null},h.push(d),u=this._apiBaseUrlString+"/"+this._apiVersion+"/"+i+"."+r,l={headers:{"content-type":"multipart/form-data"},method:"POST",url:u,oauth:this.oauth(),multipart:h},p=this,e.readFile(c,function(e,a){if(e)throw e;d.body=a;var i=n.post(l);i.hash=t.createHash("sha1").update(JSON.stringify(i.headers),"utf8").digest("hex"),p._connections[i.hash]={callback:o,data:"",httpRequest:i},p._createEventListenersForRequest(i)})},d.prototype._mimeTypeForPathExtension=function(t){var e=null;switch(t.toLowerCase()){case".gif":e="image/gif";break;case".jpeg":case".jpg":e="image/jpeg";break;case".png":e="image/png"}return e},module.exports=d;